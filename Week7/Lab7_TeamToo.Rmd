---
title: 'Lab 7: Exploratory Data Analysis'
author: "Brian Teklits, Charles Doremieux, Andrew MacLean, Clint LaBattaglia"
date: "10/13/2019"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(lubridate)

# Handle type conversions
hpc <- read_delim("household_power_consumption.txt",na = c('','?'),
                  delim=";",
  col_types = cols(
  Date = col_date("%d/%m/%Y"),
  Time = col_time("%H:%M:%S"),
  Global_active_power = col_double(),
  Global_reactive_power = col_double(),
  Global_intensity = col_double(),
  Sub_metering_1 = col_double(),
  Sub_metering_2 = col_double(),
  Sub_metering_3 = col_double()
))
```
### Data Description and Handling Missing Values

The dataset describes various electrical quantities taken from a house in France over a period of 4 years. We have information relating to current, voltage, wattage, and readings based on which rooms of the house are consuming power.

To get an idea of the missing values, we first looked at some summaries:
```{r}
hpc %>%
  filter(is.na(Voltage)) %>%
  group_by(Date) %>%
  count() %>%
  arrange(desc(n))
```
Multiple days have 1440 missing values, which corresponds to an entire day without power. We chose to drop these days from the data as they provide no information whatsoever.
```{r}
off_all_day <- hpc %>%
  filter(is.na(Voltage)) %>%
  group_by(Date) %>%
  count() %>% 
  filter(n == 1440)

hpc2 <- hpc %>%
  anti_join(off_all_day, by = "Date")
```
Then, we looked at the remaining missing values:
```{r}
outages <- hpc2 %>%
  filter(is.na(Voltage)) %>%
  group_by(Date) %>%
  count() %>%
  arrange(desc(n))
outages
```
We split these into two groups: those with more than 6 minutes of lost data in a day, and those under that threshold. We guessed that the shorter gaps in data might represent measurement malfunctions or errors, which could be filled in from the previous minute's measurements without substantially changing the data. Longer delays could indicate power outages: these could be dropped if desired.

We decided to handle these cases individually based on the questions we looked to answer. 
```{r, include=FALSE}
# Use these to plot times on a smaller dataset, takes forever to run on the entire dataset

hpc2 <- hpc2 %>% mutate(year=substr(Date,1,4), month=substr(Date, 6,7), day=substr(Date, 9,10))

hpc2 <- hpc2 %>% mutate(hour=substr(Time,1,2), minute=substr(Time, 4,5), second=substr(Time, 7,8))

hpc2 <- hpc2 %>% mutate( day=as.integer(day),
                         month=as.integer(month),
                         year=as.integer(year),
                         hour=as.integer(hour),
                         minute=as.integer(minute),
                           second=as.integer(second))

hpc2 <- hpc2 %>% mutate(datetime=make_datetime(year, month, day, hour, minute, second))
```


### Individual Sections

#### Brian

From the UCI website, we're given a formula which can calculate the energy consumption for all electrical equipment not included in the submetering 1,2, or 3 categories. I'll refer to this quantity as "other energy usage".

**Question:** What conclusions can we reach about this other energy usage? What appliances might it measure?

**Answer:** The largest contribution to other energy usage is likely central heating. Defining high usage as minutes measured at over 30 watt-hours, roughly representing the top 5% of measurements, I found that the 6 Fall and Winter months (October through March), make up the top 6 in high usage minutes. The top 5 of these are more than double the number of minutes of any Spring or Summer month. 

```{r}
hpc_other_energy <- hpc2 %>%
  mutate(other_energy = (Global_active_power*1000/60 - Sub_metering_1 - Sub_metering_2 - Sub_metering_3))

hpc_other_energy %>% 
  filter(other_energy > 30) %>%
  group_by(month) %>%
  summarise(count = n()) %>%
  arrange(desc(count))
```
The top day of high usage minutes in the dataset is December 31, 2006:
```{r}
top_day <- hpc_other_energy %>%
  filter(year == 2006, month == 12,day == 31)
ggplot(top_day) +
  geom_line(aes(datetime, other_energy)) +
  ggtitle("Energy Usage on December 31, 2006") +
  ylab("Other Energy Usage") +
  xlab("")+
  geom_hline(aes(yintercept=36),color="red")
```

In the early morning, before waking up, the only energy usage is central heating. Upon waking up, other appliances are put into use, but we still see the same baseline level of usage from the heater throughout the entire day.

**Why the Question is interesting:** Rather than taking a pre-defined quantity where we know what the measurements represent, we do the opposite. We calculate the other energy usage, and attempt to analyse what it represents.

**How did you formulate the question:** First, I used a mutate to add the new variable, then ran a few filters to get an idea of what ranges of values it took. Settling on 30 as a reasonable value for high usage, I then ran some summaries on months and days to determine the dates of highest usage. Finally, I plotted a variety of high usage days to get an idea of what similarities they had, settling on the above plot. 

**Benefit of this analysis:** A frugal homeowner might use this data to justify turning the thermostat down a few extra degrees overnight, in order to save on energy usage.

#### Clint

**Question:** What does the proportion of total average energy use by each group of metered appliances tell us about the energy use of the household? 

**Answer** The miscellaneous power drain which likely represents heating for the home was consistently using the most electricity. Interestingly, during the summer months the proportion of power use consumed by this subsection decreases and the proportion of power consumed by the water heater and air conditioner rise accordingly.  
```{r}
data1 <- hpc %>% mutate(year=substr(Date,1,4), month=substr(Date, 6,7), day=substr(Date, 9,10))

data1 <- hpc %>% mutate(hour=substr(Time,1,2), minute=substr(Time, 4,5), second=substr(Time, 7,8))

data1 <- hpc %>% mutate( day=as.integer(day),
                           month=as.integer(month),
                           year=as.integer(year),
                           hour=as.integer(hour),
                           minute=as.integer(minute),
                           second=as.integer(second))
```

```{r}

data1 <- hpc %>% 
  mutate(datetime=make_datetime(year, month, day, hour, minute, second))
```

```{r}
mean_global <- hpc %>%
  group_by(month)%>%
  summarise(Mean_global= mean(Global_active_power, na.rm = TRUE))

mean_1 <- hpc %>%
  group_by(month)%>%
  summarise(Mean_sub_1= mean(Sub_metering_1, na.rm = TRUE))%>%
  mutate(avg_use_1 = (Mean_sub_1*60)/1000)


mean_2 <- hpc %>%
  group_by(month)%>%
  summarise(Mean_sub_2= mean(Sub_metering_2, na.rm = TRUE))%>%
  mutate(avg_use_2 = (Mean_sub_2*60)/1000)
  


mean_3 <- hpc %>%
  group_by(month) %>%
  summarise(Mean_sub_3= mean(Sub_metering_3, na.rm = TRUE))%>%
  mutate(avg_use_3 = (Mean_sub_3*60)/1000)
```

```{r}
miss_energy <- hpc %>%
  select(month, Global_active_power, Sub_metering_1, Sub_metering_2, Sub_metering_3) %>%
  group_by(month)%>%
  mutate(other_energy = (Global_active_power*1000/60 - Sub_metering_1 - Sub_metering_2 - Sub_metering_3))

avg_other <- miss_energy %>%
  summarise(mean_other= mean(other_energy, na.rm = TRUE))%>%
  mutate(prep_other= (mean_other*60)/1000)
```


```{r}
experiment <- cbind(avg_other,mean_1,mean_2,mean_3,mean_global)

experiment <- experiment[, !duplicated(colnames(experiment))]

prop_test <- experiment%>%
  mutate(prop_1 = avg_use_1/Mean_global)%>%
  mutate(prop_2 = avg_use_2/Mean_global)%>%
  mutate(prop_3 = avg_use_3/Mean_global)%>%
  mutate(prop_other = prep_other/Mean_global)

prop_test_graph <- prop_test%>%
  select(month,prop_1, prop_2, prop_3, prop_other)
  
ggplot(data = prop_test_graph, mapping =  aes(x = month)) +
  geom_smooth(mapping = aes(y= prop_1, color = 'kitchen'), se=FALSE) +
  geom_smooth(mapping = aes(y = prop_2, color = 'laundry room'), se=FALSE) +
  geom_smooth(mapping = aes(y= prop_3, color = 'water heater and air conditioner'), se=FALSE) +
  geom_smooth(mapping = aes(y = prop_other, color = 'other energy drain'), se=FALSE) +
  xlab("month of the year") +
  ylab("proportion of average total power usage") +
  ggtitle("Proportion of average total power use by meter")+
  xlim(0,12)

```
**Why the Question is interesting:**
This question is interesting because it shows how the amount of power each group of metered appliances related to the total amount of electricity consumed by the household. 

**How did you formulate the question:** Initially I was curious to know how much power each metered group of appliances was using in comparison to each other, so I first converted each set into the same unit type as the global active power. After this I decided to use months as my grouping for analysis as this would yeild only 12 values which seemed more managable while still providing a useful frame for analysis. From there I found the average energy consumption for each month and then divided the average use for each metered group by the mean global energy use. 

**Benefit of this analysis:** This analysis revealed that the kitchen and laundry room consume a relatively small proportion of the electricty used by the home, which may be useful in deciding on whether or not to purchase more energy efficient appliances in those rooms as opposed to the water heater and air conditioner or heating apparatus. 

#### Name

**Question:** state question, state how it was addressed. 
```{r}
# Include Plot and Summary Statistic
```
**Why the Question is interesting:**

**How did you formulate the question:** Describe Exploratory Data Analysis techniques used

**Benefit/harm of this analysis:** One sentence

#### Andrew

**Question:** 
How does the range of values for Voltage change between winter and summer months through all 4 years.
```{r}
Summermonths <- hpc2 %>%
  filter(month >= 6 & month <=9)

Wintermonths <- hpc2 %>%
  filter(month ==12 | month <= 2)
  
ggplot(Summermonths)+
  geom_line(mapping = aes(x= Date, y = Voltage))+
  ggtitle("Voltage used During Summer Months") +
  ylab("Voltage") +
  xlab("Timeline")+
  geom_hline(aes(yintercept=250),color="red")+
  geom_hline(aes(yintercept=230),color="red")

ggplot(Wintermonths)+
  geom_line(mapping = aes(x= Date, y = Voltage))+
  ggtitle("Voltage used During Winter Months")+
  ylab("Voltage") +
  xlab("Timeline")+
  geom_hline(aes(yintercept=250),color="red")+
  geom_hline(aes(yintercept=230),color="red")
```
**Answer**
We can see that durong the Winter, the voltage varies more often than it does during the summer. This could be do to more electricity being used during the winter due to weather or other circumstances. We can also notice that the winter months usual go past either of the red lines each year but during the summer, the values for the voltage became narrower between the red lines as time went on. Not once did the voltage of the house go over 250 volts from 2008-2010. We can tell now that winter often uses more electricity than the summmer while also ranging over a large scale of values.

**Why the Question is interesting:**
This question is interesting because Summer and Winter are often the two seasons where voltage is used the most often due to extreme weather.This test will allow us to compare the range of values of Voltage depending on the year and months.
**How did you formulate the question:** 
After exploring through the data I noticed that over time the house was able to limit the range of voltage values during summer months past year 2009. This led me to question how the voltage differed depending on the year. I created the horizontal red lines in order to display that the range of values for Winter months is often larger than those of summer months. You can also compare each year by year and notice that the range of values for voltage also narrows down as the years go on.

**Benefit of Analysis**
The observation that winter is more likely to use more voltage than summer months gives the homeowner knowledge of when he is more likely to use more voltage and be prepared to try an limit that amount.

