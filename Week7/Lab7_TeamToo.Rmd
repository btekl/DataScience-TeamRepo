---
title: 'Lab 7: Exploratory Data Analysis'
author: "Brian Teklits, Charles Doremieux, Andrew MacLean, Clint LaBattaglia"
date: "10/13/2019"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(lubridate)

# Handle type conversions
hpc <- read_delim("household_power_consumption.txt",na = c('','?'),
                  delim=";",
  col_types = cols(
  Date = col_date("%d/%m/%Y"),
  Time = col_time("%H:%M:%S"),
  Global_active_power = col_double(),
  Global_reactive_power = col_double(),
  Global_intensity = col_double(),
  Sub_metering_1 = col_double(),
  Sub_metering_2 = col_double(),
  Sub_metering_3 = col_double()
))
```
### Data Description and Handling Missing Values

The dataset describes various electrical quantities taken from a house in France over a period of 4 years. We have information relating to current, voltage, wattage, and readings based on which rooms of the house are consuming power.

To get an idea of the missing values, we first looked at some summaries:
```{r}
hpc %>%
  filter(is.na(Voltage)) %>%
  group_by(Date) %>%
  count() %>%
  arrange(desc(n))
```
Multiple days have 1440 missing values, which corresponds to an entire day without power. We chose to drop these days from the data as they provide no information whatsoever.
```{r}
off_all_day <- hpc %>%
  filter(is.na(Voltage)) %>%
  group_by(Date) %>%
  count() %>% 
  filter(n == 1440)

hpc2 <- hpc %>%
  anti_join(off_all_day, by = "Date")
```
Then, we looked at the remaining missing values:
```{r}
outages <- hpc2 %>%
  filter(is.na(Voltage)) %>%
  group_by(Date) %>%
  count() %>%
  arrange(desc(n))
outages
```
We split these into two groups: those with more than 6 minutes of lost data in a day, and those under that threshold. We guessed that the shorter gaps in data might represent measurement malfunctions or errors, which could be filled in from the previous minute's measurements without substantially changing the data. Longer delays could indicate power outages: these could be dropped if desired.

We decided to handle these cases individually based on the questions we looked to answer. 
```{r, include=FALSE}
# Use these to plot times on a smaller dataset, takes forever to run on the entire dataset

hpc2 <- hpc2 %>% mutate(year=substr(Date,1,4), month=substr(Date, 6,7), day=substr(Date, 9,10))

hpc2 <- hpc2 %>% mutate(hour=substr(Time,1,2), minute=substr(Time, 4,5), second=substr(Time, 7,8))

hpc2 <- hpc2 %>% mutate( day=as.integer(day),
                         month=as.integer(month),
                         year=as.integer(year),
                         hour=as.integer(hour),
                         minute=as.integer(minute),
                           second=as.integer(second))

hpc2 <- hpc2 %>% mutate(datetime=make_datetime(year, month, day, hour, minute, second))
```


### Individual Sections

#### Brian

From the UCI website, we're given a formula which can calculate the energy consumption for all electrical equipment not included in the submetering 1,2, or 3 categories. I'll refer to this quantity as "other energy usage".

**Question:** What conclusions can we reach about this other energy usage? What appliances might it measure?

**Answer:** The largest contribution to other energy usage is likely central heating. Defining high usage as minutes measured at over 30 watt-hours, roughly representing the top 5% of measurements, I found that the 6 Fall and Winter months (October through March), make up the top 6 in high usage minutes. The top 5 of these are more than double the number of minutes of any Spring or Summer month. 

```{r}
hpc_other_energy <- hpc2 %>%
  mutate(other_energy = (Global_active_power*1000/60 - Sub_metering_1 - Sub_metering_2 - Sub_metering_3))

hpc_other_energy %>% 
  filter(other_energy > 30) %>%
  group_by(month) %>%
  summarise(count = n()) %>%
  arrange(desc(count))
```
The top day of high usage minutes in the dataset is December 31, 2006:
```{r}
top_day <- hpc_other_energy %>%
  filter(year == 2006, month == 12,day == 31)
ggplot(top_day) +
  geom_line(aes(datetime, other_energy)) +
  ggtitle("Energy Usage on December 31, 2006") +
  ylab("Other Energy Usage") +
  xlab("")+
  geom_hline(aes(yintercept=36),color="red")
```

In the early morning, before waking up, the only energy usage is central heating. Upon waking up, other appliances are put into use, but we still see the same baseline level of usage from the heater throughout the entire day.

**Why the Question is interesting:** Rather than taking a pre-defined quantity where we know what the measurements represent, we do the opposite. We calculate the other energy usage, and attempt to analyse what it represents.

**How did you formulate the question:** First, I used a mutate to add the new variable, then ran a few filters to get an idea of what ranges of values it took. Settling on 30 as a reasonable value for high usage, I then ran some summaries on months and days to determine the dates of highest usage. Finally, I plotted a variety of high usage days to get an idea of what similarities they had, settling on the above plot. 

**Benefit of this analysis:** A frugal homeowner might use this data to justify turning the thermostat down a few extra degrees overnight, in order to save on energy usage.

#### Name

**Question:** state question, state how it was addressed. 
```{r}
# Include Plot and Summary Statistic
```
**Why the Question is interesting:**

**How did you formulate the question:** Describe Exploratory Data Analysis techniques used

**Benefit/harm of this analysis:** One sentence

#### Name

**Question:** state question, state how it was addressed. 
```{r}
# Include Plot and Summary Statistic
```
**Why the Question is interesting:**

**How did you formulate the question:** Describe Exploratory Data Analysis techniques used

**Benefit/harm of this analysis:** One sentence

#### Andrew

**Question:** state question, state how it was addressed. 
```{r}
# Include Plot and Summary Statistic
```
**Why the Question is interesting:**

**How did you formulate the question:** Describe Exploratory Data Analysis techniques used


