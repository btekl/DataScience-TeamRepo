knitr::opts_chunk$set(warning=FALSE,message=FALSE)
library(tidyverse)
pump_price <- read_csv("pump_price_for_gasoline_us_per_liter.csv",col_types = cols(`1993` = col_double(),
`1994` = col_double(),
`1996` = col_double(),
`1997` = col_double(),
`1999` = col_double(),
`2001` = col_double(),
`2003` = col_double(),
`2005` = col_double(),
`2007` = col_double(),
`2009` = col_double(),
`2011` = col_double(),
`2013` = col_double(),
`2015` = col_double()))
co2_emissions <- read_csv("co2_emissions_tonnes_per_person.csv")
co2_emissions <- co2_emissions %>%
gather(`1800`:`2014`,key='year',value='CO2 Emissions (Tonnes/person)')
pump_price <- pump_price %>%
gather(`1991`:`2016`,key = 'year',value = 'Pump Price ($/L)')
co2_and_pump <- co2_emissions %>%
inner_join(pump_price, by = c('country','year')) %>%
filter(!is.na(`Pump Price ($/L)`) & !is.na(`CO2 Emissions (Tonnes/person)`))
#The code for the map function you used and a brief description of what the code is doing
(act_cor <- co2_and_pump %>%
#  group_by(country) %>%
#  filter(country=='United States') %>%
nest() %>%
mutate(cor = map(data, ~cor(.x$`CO2 Emissions (Tonnes/person)`, .x$`Pump Price ($/L)`))) %>%
unnest(cor, .drop = TRUE) %>%
arrange(desc(cor)))
perm_test_cor <- numeric(1000)
for(i in seq_along(perm_test_cor)){
s <- sample(co2_and_pump$`CO2 Emissions (Tonnes/person)`)
perm_test_cor[i] <- cor(co2_and_pump$`Pump Price ($/L)`,s)
}
ggplot(tibble(perm_test_cor),aes(perm_test_cor))+geom_histogram(bins = 50)+
geom_vline(xintercept = act_cor$cor, color='red')
sum(act_cor$cor > perm_test_cor)/length(perm_test_cor)
#The code for the map function you used and a brief description of what the code is doing
#The code for the map function you used and a brief description of what the code is doing
View(gapminder)
sex_ratio <- read.csv("sex_ratio_15_49_years.csv")
suicides_100k <- read.csv("suicide_per_100000_people.csv")
View(suicides_100k)
suicides_100k <- read_csv("suicide_per_100000_people.csv")
sex_ratio <- read_csv("sex_ratio_15_49_years.csv")
View(suicides_100k)
suicides_100k <- read_csv("suicide_per_100000_people.csv") %>% filter(!is.na())
suicides_100k <- read_csv("suicide_per_100000_people.csv")
sex_ratio <- read_csv("sex_ratio_15_49_years.csv")
suicides_100k <- suicides_100k[complete.cases(),]
View(co2_emissions)
suicides_100k <- suicides_100k %>%
gather(`1950`:`1998`,key='year',value='Suicides (per 100k people)')
View(suicides_100k)
suicides_100k <- suicides_100k %>%
gather(1950:1998,key='year',value='Suicides (per 100k people)')
co2_emissions <- co2_emissions %>%
gather(`1800`:`2014`,key='year',value='CO2 Emissions (Tonnes/person)')
knitr::opts_chunk$set(warning=FALSE,message=FALSE)
library(tidyverse)
pump_price <- read_csv("pump_price_for_gasoline_us_per_liter.csv",col_types = cols(`1993` = col_double(),
`1994` = col_double(),
`1996` = col_double(),
`1997` = col_double(),
`1999` = col_double(),
`2001` = col_double(),
`2003` = col_double(),
`2005` = col_double(),
`2007` = col_double(),
`2009` = col_double(),
`2011` = col_double(),
`2013` = col_double(),
`2015` = col_double()))
co2_emissions <- read_csv("co2_emissions_tonnes_per_person.csv")
co2_emissions <- co2_emissions %>%
gather(`1800`:`2014`,key='year',value='CO2 Emissions (Tonnes/person)')
pump_price <- pump_price %>%
gather(`1991`:`2016`,key = 'year',value = 'Pump Price ($/L)')
co2_and_pump <- co2_emissions %>%
inner_join(pump_price, by = c('country','year')) %>%
filter(!is.na(`Pump Price ($/L)`) & !is.na(`CO2 Emissions (Tonnes/person)`))
View(pump_price)
knitr::opts_chunk$set(warning=FALSE,message=FALSE)
library(tidyverse)
pump_price <- read_csv("pump_price_for_gasoline_us_per_liter.csv",col_types = cols(`1993` = col_double(),
`1994` = col_double(),
`1996` = col_double(),
`1997` = col_double(),
`1999` = col_double(),
`2001` = col_double(),
`2003` = col_double(),
`2005` = col_double(),
`2007` = col_double(),
`2009` = col_double(),
`2011` = col_double(),
`2013` = col_double(),
`2015` = col_double()))
co2_emissions <- read_csv("co2_emissions_tonnes_per_person.csv")
View(pump_price)
pump_price <- pump_price %>%
gather(`1991`:`2016`,key = 'year',value = 'Pump Price ($/L)')
pump_price <- pump_price %>%
gather(`1991`:`2016`,key = 'year',value = 'Pump Price ($/L)')
pump_price <- pump_price %>%
gather(`1991`:`2016`,key = 'year',value = 'Pump Price ($/L)')
co2_emissions <- co2_emissions %>%
gather(`1800`:`2014`,key='year',value='CO2 Emissions (Tonnes/person)')
View(co2_emissions)
sex_ratio <- read_csv("sex_ratio_15_49_years.csv")
suicides_100k <- read_csv("suicide_per_100000_people.csv")
View(suicides_100k)
suicides_100k <- suicides_100k %>%
gather(`1950`:`1998`,key='year',value='Suicides (per 100k people)')
View(suicides_100k)
suicides_100k <- read_csv("suicide_per_100000_people.csv")
sex_ratio <- read_csv("sex_ratio_15_49_years.csv")
suicides_100k <- suicides_100k %>%
gather(`1950`:`2016`,key='year',value='Suicides (per 100k people)')
View(suicides_100k)
View(sex_ratio)
sex_ratio <- sex_ratio %>%
gather(`1950`:`2016`,key='year',value='Male/Female Ratio')
View(sex_ratio)
sex_ratio <- sex_ratio %>%
gather(`1950`:`2065`,key='year',value='Male/Female Ratio')
sex_ratio <- sex_ratio %>%
gather(`1950`:`2065`,key='year',value='Male/Female Ratio')
sex_ratio <- read_csv("sex_ratio_15_49_years.csv")
View(sex_ratio)
sex_ratio <- sex_ratio %>%
gather(`1950`:`2100`,key='year',value='Male/Female Ratio')
View(sex_ratio)
suicides_100k <- suicides_100k %>%
gather(`1950`:`2016`,key='year',value='Suicides (per 100k people)') %>%
filter(!is.na(`Suicides (per 100k people)`))
suicides_100k <- read_csv("suicide_per_100000_people.csv")
sex_ratio <- read_csv("sex_ratio_15_49_years.csv")
suicides_100k <- suicides_100k %>%
gather(`1950`:`2016`,key='year',value='Suicides (per 100k people)') %>%
filter(!is.na(`Suicides (per 100k people)`))
sex_ratio <- sex_ratio %>%
gather(`1950`:`2100`,key='year',value='Male/Female Ratio')
View(suicides_100k)
suicides_100k <- read_csv("suicide_per_100000_people.csv")
sex_ratio <- read_csv("sex_ratio_15_49_years.csv")
suicides_100k <- suicides_100k %>%
gather(`1950`:`2016`,key='year',value='Suicides (per 100k people)') %>%
filter(!is.na(`Suicides (per 100k people)`))
sex_ratio <- sex_ratio %>%
gather(`1950`:`2100`,key='year',value='Male/Female Ratio') %>%
filter(!is.na(`Male/Female Ratio`))
View(sex_ratio)
suicides_100k <- read_csv("suicide_per_100000_people.csv")
sex_ratio <- read_csv("sex_ratio_15_49_years.csv")
suicides_100k <- suicides_100k %>%
gather(`1950`:`2016`,key='year',value='Suicides (per 100k people)') %>%
filter(!is.na(`Suicides (per 100k people)`))
sex_ratio <- sex_ratio %>%
gather(`1950`:`2100`,key='year',value='Male/Female Ratio') %>%
filter(!is.na(`Male/Female Ratio`))
sex_ratio <- sex_ratio %>%
gather(`1950`:`2100`,key='year',value='Male/Female Ratio') %>%
filter(!is.na(`Male/Female Ratio`) & year < 2017)
suicides_100k <- read_csv("suicide_per_100000_people.csv")
sex_ratio <- read_csv("sex_ratio_15_49_years.csv")
suicides_100k <- suicides_100k %>%
gather(`1950`:`2016`,key='year',value='Suicides (per 100k people)') %>%
filter(!is.na(`Suicides (per 100k people)`))
sex_ratio <- sex_ratio %>%
gather(`1950`:`2100`,key='year',value='Male/Female Ratio') %>%
filter(!is.na(`Male/Female Ratio`) & year < 2017)
View(sex_ratio)
suicides_100k <- read_csv("suicide_per_100000_people.csv")
sex_ratio <- read_csv("sex_ratio_15_49_years.csv")
suicides_100k <- suicides_100k %>%
gather(`1950`:`2016`,key='year',value='Suicides (per 100k people)') %>%
filter(!is.na(`Suicides (per 100k people)`) & year < 2016)
sex_ratio <- sex_ratio %>%
gather(`1950`:`2100`,key='year',value='Male/Female Ratio') %>%
filter(!is.na(`Male/Female Ratio`) & year < 2017)
View(suicides_100k)
knitr::opts_chunk$set(warning=FALSE,message=FALSE)
library(tidyverse)
pump_price <- read_csv("pump_price_for_gasoline_us_per_liter.csv",col_types = cols(`1993` = col_double(),
`1994` = col_double(),
`1996` = col_double(),
`1997` = col_double(),
`1999` = col_double(),
`2001` = col_double(),
`2003` = col_double(),
`2005` = col_double(),
`2007` = col_double(),
`2009` = col_double(),
`2011` = col_double(),
`2013` = col_double(),
`2015` = col_double()))
co2_emissions <- read_csv("co2_emissions_tonnes_per_person.csv")
co2_emissions <- co2_emissions %>%
gather(`1800`:`2014`,key='year',value='CO2 Emissions (Tonnes/person)')
pump_price <- pump_price %>%
gather(`1991`:`2016`,key = 'year',value = 'Pump Price ($/L)')
co2_and_pump <- co2_emissions %>%
inner_join(pump_price, by = c('country','year')) %>%
filter(!is.na(`Pump Price ($/L)`) & !is.na(`CO2 Emissions (Tonnes/person)`))
t <- co2_and_pump %>% group_by(country) %>% count() %>% filter(n>=10)
(cor_by_country <- co2_and_pump %>%
semi_join(t) %>%
group_by(country) %>%
nest() %>%
mutate(cor = map(data, ~cor(.x$`CO2 Emissions (Tonnes/person)`, .x$`Pump Price ($/L)`))) %>%
unnest(cor, .drop = TRUE) %>%
arrange((cor)))
USA <- co2_and_pump %>% filter(country == "United States")
perm_test_cor_team <- numeric(1000)
for(i in seq_along(perm_test_cor_team)){
# Randomize one of variables of interest:
s <- sample(USA$`CO2 Emissions (Tonnes/person)`)
# Find the correlation between the un-randomized vector and the randomized vector
perm_test_cor_team[i] <- cor(USA$`Pump Price ($/L)`,s)
}
USA_cor <- filter(cor_by_country,country == 'United States')$cor
ggplot(tibble(perm_test_cor_team),aes(perm_test_cor_team))+geom_histogram(bins = 30)+
geom_vline(xintercept = USA_cor, color='red')
sum(perm_test_cor_team > USA_cor)/length(perm_test_cor_team)
#The code for the map function you used and a brief description of what the code is doing
(act_cor <- co2_and_pump %>%
#  group_by(country) %>%
nest() %>%
mutate(cor = map(data, ~cor(.x$`CO2 Emissions (Tonnes/person)`, .x$`Pump Price ($/L)`))) %>%
unnest(cor, .drop = TRUE))
child_mort <- read_csv("child_mortality_0_5_year_olds_dying_per_1000_born.csv")
birthrate <- read_csv("children_per_woman_total_fertility.csv")
child_mort <- child_mort%>%
gather('1800':'2018', key = 'year', value = "Child Mortality (# of Deaths per Thousand Births")
birthrate <- birthrate%>%
gather('1800':'2018', key = 'year', value = "Birthrate (# of Children per woman)")
mort_2018 <- child_mort%>%
filter(year == "2018", !is.na(`Child Mortality (# of Deaths per Thousand Births`))%>%
arrange(desc(`Child Mortality (# of Deaths per Thousand Births`))
birth_2018 <- birthrate%>%
filter(year == "2018",!is.na(`Birthrate (# of Children per woman)`))%>%
arrange(desc(`Birthrate (# of Children per woman)`))
top_mort <- mort_2018%>%
filter(`Child Mortality (# of Deaths per Thousand Births` >= 42.90)
bottom_mort <- mort_2018%>%
filter(mort_2018$`Child Mortality (# of Deaths per Thousand Births` <= 7.97)
top_birth <- birth_2018%>%
filter(`Birthrate (# of Children per woman)` >= 3.56)
bottom_birth <-birth_2018%>%
filter(`Birthrate (# of Children per woman)` <= 1.76)
high_and_low_mort <- top_mort %>% full_join(bottom_mort)
high_and_low_birth <- top_birth %>% full_join(bottom_birth)
combined_data <- high_and_low_birth%>% inner_join(high_and_low_mort, by = c('country','year'))
real_cor <- cor(x = combined_data$`Birthrate (# of Children per woman)`,y = combined_data$`Child Mortality (# of Deaths per Thousand Births`) # 0.927
perm_test_clint <- numeric(1000)
for(i in seq_along(perm_test_clint)){
sam <- sample(combined_data$`Birthrate (# of Children per woman)`)
perm_test_clint[i] <- cor(combined_data$`Child Mortality (# of Deaths per Thousand Births`,sam)
}
percentiles_cor_test <- ecdf(perm_test_clint)
percentiles_cor_test(real_cor) #1
range(perm_test_clint) #-0.337, 0.356
ggplot(tibble(perm_test_clint),aes(perm_test_clint))+geom_histogram(bins = 50)+
geom_vline(xintercept = real_cor, color='yellow')
suicides_100k <- read_csv("suicide_per_100000_people.csv")
sex_ratio <- read_csv("sex_ratio_15_49_years.csv")
suicides_100k <- suicides_100k %>%
gather(`1950`:`2016`,key='year',value='Suicides (per 100k people)') %>%
filter(!is.na(`Suicides (per 100k people)`) & year < 2016)
sex_ratio <- sex_ratio %>%
gather(`1950`:`2100`,key='year',value='Male/Female Ratio') %>%
filter(!is.na(`Male/Female Ratio`) & year < 2016)
co2_emissions <- co2_emissions %>%
gather(`1800`:`2014`,key='year',value='CO2 Emissions (Tonnes/person)')
knitr::opts_chunk$set(warning=FALSE,message=FALSE)
library(tidyverse)
pump_price <- read_csv("pump_price_for_gasoline_us_per_liter.csv",col_types = cols(`1993` = col_double(),
`1994` = col_double(),
`1996` = col_double(),
`1997` = col_double(),
`1999` = col_double(),
`2001` = col_double(),
`2003` = col_double(),
`2005` = col_double(),
`2007` = col_double(),
`2009` = col_double(),
`2011` = col_double(),
`2013` = col_double(),
`2015` = col_double()))
co2_emissions <- read_csv("co2_emissions_tonnes_per_person.csv")
co2_emissions <- co2_emissions %>%
gather(`1800`:`2014`,key='year',value='CO2 Emissions (Tonnes/person)')
pump_price <- pump_price %>%
gather(`1991`:`2016`,key = 'year',value = 'Pump Price ($/L)')
co2_and_pump <- co2_emissions %>%
inner_join(pump_price, by = c('country','year')) %>%
filter(!is.na(`Pump Price ($/L)`) & !is.na(`CO2 Emissions (Tonnes/person)`))
View(co2_and_pump)
suicide_plus_ratio <- sex_ratio %>%
inner_join(suicide_plus_ratio, by = c('country','year')) %>%
filter(!is.na(`Suicides (per 100k people)`) & !is.na(`Male/Female Ratio`))
suicides_100k <- read_csv("suicide_per_100000_people.csv")
sex_ratio <- read_csv("sex_ratio_15_49_years.csv")
suicides_100k <- suicides_100k %>%
gather(`1950`:`2016`,key='year',value='Suicides (per 100k people)') %>%
filter(!is.na(`Suicides (per 100k people)`) & year < 2016)
sex_ratio <- sex_ratio %>%
gather(`1950`:`2100`,key='year',value='Male/Female Ratio') %>%
filter(!is.na(`Male/Female Ratio`) & year < 2016)
suicide_plus_ratio <- sex_ratio %>%
inner_join(suicide_plus_ratio, by = c('country','year')) %>%
filter(!is.na(`Suicides (per 100k people)`) & !is.na(`Male/Female Ratio`))
suicide_plus_ratio <- sex_ratio %>%
inner_join(suicide_plus_ratio, by = c('country','year'))
merge_purge <- sex_ratio %>%
inner_join(suicide_plus_ratio, by = c('country','year'))
suicide_plus_ratio <- sex_ratio %>%
inner_join(suicides_100k, by = c('country','year'))
View(suicide_plus_ratio)
all_cor <- suicide_plus_ratio %>% group_by(country) %>%
count()
all_cor
all_cor <- suicide_plus_ratio %>% group_by(country) %>%
count() %>%
filter(n >= 10)
all_cor
ams <- suicide_plus_ratio %>% group_by(country) %>%
count() %>%
filter(n >= 10)
suicide_plus_ratio <- sex_ratio %>%
inner_join(suicides_100k, by = c('country','year'))
ams <- suicide_plus_ratio %>% group_by(country) %>%
count() %>%
filter(n >= 10)
all_cors <- suicide_plus_ratio %>% semijoin(ams) %>% group_by(country) %>% nest() %>% (correlation = map(data, ~cor(.x$`Suicides (per 100k people)`, .x$`Male/Female Ratio`)))
suicides_100k <- read_csv("suicide_per_100000_people.csv")
sex_ratio <- read_csv("sex_ratio_15_49_years.csv")
suicides_100k <- suicides_100k %>%
gather(`1950`:`2016`,key='year',value='Suicides (per 100k people)') %>%
filter(!is.na(`Suicides (per 100k people)`) & year < 2016)
sex_ratio <- sex_ratio %>%
gather(`1950`:`2100`,key='year',value='Male/Female Ratio') %>%
filter(!is.na(`Male/Female Ratio`) & year < 2016)
suicide_plus_ratio <- sex_ratio %>%
inner_join(suicides_100k, by = c('country','year'))
ams <- suicide_plus_ratio %>% group_by(country) %>%
count() %>%
filter(n >= 10)
all_cors <- suicide_plus_ratio %>% semijoin(ams) %>% group_by(country) %>% nest() %>% (correlation = map(data, ~cor(.x$`Suicides (per 100k people)`, .x$`Male/Female Ratio`)))
suicide_plus_ratio <- sex_ratio %>%
inner_join(suicides_100k, by = c('country','year'))
ams <- suicide_plus_ratio %>% group_by(country) %>%
count() %>%
filter(n >= 10)
all_cors <- suicide_plus_ratio %>%
semijoin(ams) %>% group_by(country) %>%
nest() %>%
(correlation = map(data, ~cor(.x$`Suicides (per 100k people)`, .x$`Male/Female Ratio`))) %>%
unnest(cor, .drop = TRUE) %>%
arrange((cor)))
suicide_plus_ratio <- sex_ratio %>%
inner_join(suicides_100k, by = c('country','year'))
ams <- suicide_plus_ratio %>% group_by(country) %>%
count() %>%
filter(n >= 10)
all_cors <- suicide_plus_ratio %>%
semijoin(ams) %>% group_by(country) %>%
nest() %>%
(correlation = map(data, ~cor(.x$`Suicides (per 100k people)`, .x$`Male/Female Ratio`))) %>%
unnest(cor, .drop = TRUE) %>%
arrange((cor))
(all_cors <- suicide_plus_ratio %>%
semijoin(ams) %>% group_by(country) %>%
nest() %>%
(correlation = map(data, ~cor(.x$`Suicides (per 100k people)`, .x$`Male/Female Ratio`))) %>%
unnest(cor, .drop = TRUE) %>%
arrange((cor)))
(all)cors <- suicide_plus_ratio %>%
(all_cors <- suicide_plus_ratio %>%
semi_join(t) %>%
group_by(country) %>%
nest() %>%
mutate(cor = map(data, ~cor(.x$`CO2 Emissions (Tonnes/person)`, .x$`Pump Price ($/L)`))) %>%
unnest(cor, .drop = TRUE) %>%
arrange((cor)))
(all_cors <- suicide_plus_ratio %>%
semi_join(t) %>%
group_by(country) %>%
nest() %>%
mutate(cor = map(data, ~cor(.x$`Suicides (per 100k people)`, .x$`Pump Price ($/L)`))) %>%
unnest(cor, .drop = TRUE) %>%
arrange((cor)))
(all_cors <- suicide_plus_ratio %>%
semi_join(t) %>%
group_by(country) %>%
nest() %>%
mutate(cor = map(data, ~cor(.x$`Suicides (per 100k people)`, .x$`Male/Female Ratio`))) %>%
unnest(cor, .drop = TRUE) %>%
arrange((cor)))
