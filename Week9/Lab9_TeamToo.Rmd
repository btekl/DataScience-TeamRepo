---
title: "Lab 9: Data Science to Solve Problems and Answer Questions, part 2"
author: "Brian Teklits, Charles Doremieux, Andrew MacLean, Clint LaBattaglia"
date: "10/25/2019"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
candy <- read_csv("https://www.scq.ubc.ca/wp-content/uploads/2017/10/candyhierarchy2017.csv")

knitr::opts_chunk$set(warning=FALSE,message=FALSE)
# Fix non UTF characters
names(candy) <- iconv(names(candy), to='ASCII', sub='')

candy <- select(candy,-`Internal ID`,-`X114`)

# Regex to simplify column names
colnames(candy) <- str_replace(colnames(candy), regex("^Q[\\d]+:?[\\s]*\\|?[\\s]+(.*)$"),"\\1")
candy <- rename(candy, "State" = `STATE, PROVINCE, COUNTY, ETC`)

USA_Names <- c("'merica", "Ahem....Amerca", "Alaska", "america","America","California", "Murica", "murrika","I pretend to be from Canada, but I am really from the United States.","New Jersey","New York",	"North Carolina", "Pittsburgh","The United States","The United States of America","Trumpistan", "U S",	"u s a","u.s.","U.S.","u.s.a.","U.S.A.","unhinged states","Unied States","unite states","United Sates","United staes","United State","United Statea","United Stated","united states","united States","United states","United States","united states of america","United States of America","United Statss","united ststes","United ststes","Unites States","us","Us","US","US of A","usa","Usa","USa","USA","USA USA USA!!!!","USA! USA! USA!","USA? Hard to tell anymore..", "USAA","usas", "USAUSAUSA","USSA")
Canada_Names <- c("Can","canada","Canada","CANADA","Canada`","soviet canuckistan")
UK_Names <- c("endland","England","Scotland", "U.K.","uk","Uk","UK","United kingdom","United Kingdom")
Unknowns = c(1,32,35,45,46, "A", "Earth", "Fear and Loathing","I don't know anymore", "Narnia", "subscribe to dm4uz3 on youtube",	NA,"insanity lately","Canae","cascadia","Atlantis","Europe","UD","N. America")
Cali_Names <- c("CA","ca","Ca","alameda county, california","BERKELEY, CA","CA, Alameda","cailifornia","Cali","calif","Califor","califormia","California, Contra Costa County, Pleasant Hill", "California, Mendocino County", "California, San Diego", "California, San Diego county","California, San Francisco", "California, USA","California, Ventura County","Glendora, Los Angeles, California","Los Angeles, California","La","Oakland, California","oakland,ca","San Jose","Santa Barbara co. California","Santa Clara County, California","Santa Cruz County, California","California, Alameda", "california", "orange county, ca")
WA_Names <- c("Washington","WA","Wa","wa","Washington, Clark","Washington, King","Washington State","Washington, King County","washington","Washington state","Washington, Seattle, king","Washington state, Kitsap County","Issaquah, WA, King County","Washington, seattle, king","hatcom County, WA","Washington State, King County", "City of Seattle","Whatcom County, WA","Washington State, King County, City of Seattle","King County, Washington","Washington, Island county","renton,wa","wa, spokane","Vancouver, Wa","Washingto")
NY_Names <- c("NY", "New York","Ny","ny","new york","New york","NEW YORK","nyc","New York County, New York City, New York State","New York, New York","New York, NY","NY, Tompkins County","NYC","suffolk county ny","ulster county, NY","Astoria NY","Kings, New York","Queens","Brooklyn, kings county ny","DUTCHESS COUNTY NY","Brooklyn")
PA_Names <- c("PA","pa","Pa","Pa.   Northampton county","pennsylvania","PEnnsylvania","PENNSYLVANIA","Pennsylvania, Montgomery County","pennsylvania, northampton couny, easton","philadelphia","Philadelphia","Philadelphia PA","Philadelphia, PA","Pittsburgh pa","exton pa", "Northampton County, PA")
IL_Names <- c("IL","Chicago, Illinois","Il","illinois","Illinois","Chicago, IL","ill","il","Northbrook, IL","Chicago")
MN_Names <- c("MN","mn","Mn","minnesota","Carver county, MN")
TX_Names <- c("TX","tx","Tx.","Tx","TEXAS","texas", "Harris County, Texas")
MASS_Names <- c("MA","ma","massachusetts","Ma","Massachusetts, Plymouth county","Massachussets")
NC_Names <- c("NC","nc","north carolina","North carolina","Buncombe County, North Carolina","Durham County, North Carolina","Nc","The Democratic People's Republic of North Carolina","	|NC")
GA_Names <- c("GA","Ga","GA - Georgia","georgia","Marietta, GA","Atlanta, GA")
VA_Names <- c("VA","va","virginia","Henrico, VA","Rappahannock County, VA","arlington, va","Arlington, VA","Va","Virginia, Arlington")
OR_Names <- c("OR","oregon","or","OREGON","Or","Oregon - but will be in Washington for Halloween",	"Oregon, Multnomah County")
CO_Names <- c("CO","Colorado","CO, Larimer County","Colorado, Jefferson county","colorado","co","colorado, boulder", "COLORADO","Colorado larimer county","Co","Colorado (CO)")
BC_Names <- c("BC","Bc","bc","british columbia","British Columbia, Canada","vancouver, bc")
ONT_Names <- c("ontario","ONTARIO","Toronto, Ontario","ON","On","ont","Ont","Ontario,  Canada","Oshawa, Ontario, Canada")
FL_Names <- c("FL","Orlando, FL","Orlando, FL")
IN_Names <- c("IN","indiana","Bloomington, IN","in")
MO_Names <- c("MO","mo","Mo","missouri","Missoure","Missouri, Miller County","St Louis mo","St. Louis County, Missouri")
FL_Names <- c("FL","florida","Fl","FL, Orange County","st. augustine florida")
NJ_Names <- c("NJ","Nj","New jersey","nj","NJ, Gloucester", "NJ; Essex")
MI_Names <- c("MI","Mi","mi","michigan","Kalamazoo County, MI","Mich","Michigan, Shiawassee County","Michigin","Oakland County, Michigan")
OH_Names <- c("OH","ohio","Cuyahoga County, Ohio")
MD_Names <- c("MD","md","maryland","MARYLAND","Md")
DC_Names <- c("DC","dc","District of Columbia","Dc", "Washington DC","WASHINGTON DC","Washington, DC")
NM_Names <- c("NM","nm","Dona Ana county, New Mexico", "New Mexico, USA","Nm")
IA_Names <- c("IA","iowa","Ia")
KS_Names <- c("KS","kansas","Ks")
CT_Names <- c("CT","ct","connecticut")
MA_Names <- c("maine","Portland, maine")
NH_Names <- c("NH","new hampshire","nh","Nh")
NV_Names <- c("NV")
RI_Names <- c("RI","rhode island","Rhode island","Ri","ri")
UT_Names <- c("UT","Ut","UT, Salt Lake","utah")
WI_Names <- c("WI","wisconsin","Wi","Wisconsin, 53705")
WV_Names <- c("WV","wv","WV, Kanawha County","west virginia")
AB_Names <- c("AB","alberta")
SC_Names <- c("SC","sc")
KY_Names <- c("KY","kentucky","Ky")
TN_Names <- c("TN","tn","Knox county, Tennessee","Tn", "tennessee","Tennessee, Knox County")
AZ_Names <- c("AZ","az","Az","phoenix, maricopa county, arizona")
VT_Names <- c("vt","VT","Vt","VT, Chittenden")
OK_Names <- c("OK","oklahoma")
NS_Names <- c("NS")
HI_Names <- c("HI","hi")
QC_Names <- c("QC")

Age_Conv_59 <- c("59 on the day after Halloween")
Age_Conv_60 <- c("60+")
Age_Conv_70 <- c("70 1/2")
Age_Conv_46 <- c("46 Halloweens.","I can remember when Java was a cool new language")
Age_Conv_40 <- c("Many","old","OLD",	"old enough","39.4")
Age_Conv_50 <- c("Over 50","Old enough","older than dirt","ancient","Enough")
Age_Conv_Un <- c("?","hahahahaha","MY NAME JEFF","no","See question 2","sixty-nine","your mom","5u")

# Copying state data to proper column
candy$State[candy$COUNTRY == "California"] <- "California"
candy$State[candy$COUNTRY == "New Jersey"] <- "New Jersey"
candy$State[candy$COUNTRY == "New York"] <- "New York"
candy$State[candy$COUNTRY == "North Carolina"] <- "North Carolina"
candy$State[candy$COUNTRY == "Pittsburgh"] <- "Pennsylvania"

# replacing various names to a single name
candy$State[candy$State %in% Cali_Names] <- "California"
candy$State[candy$State %in% WA_Names] <- "Washington"
candy$State[candy$State %in% NY_Names] <- "New York"
candy$State[candy$State %in% PA_Names] <- "Pennsylvania"
candy$State[candy$State %in% IL_Names] <- "Illinois"
candy$State[candy$State %in% MN_Names] <- "Minnesota"
candy$State[candy$State %in% TX_Names] <- "Texas"
candy$State[candy$State %in% MASS_Names] <- "Massachusetts"
candy$State[candy$State %in% OR_Names] <- "Oregon"
candy$State[candy$State %in% VA_Names] <- "Virginia"
candy$State[candy$State %in% GA_Names] <- "Georgia"
candy$State[candy$State %in% NC_Names] <- "North Carolina"
candy$State[candy$State %in% CO_Names] <- "Colorado"
candy$State[candy$State %in% BC_Names] <- "British Columbia"
candy$State[candy$State %in% ONT_Names] <- "Ontario"
candy$State[candy$State %in% FL_Names] <- "Florida"
candy$State[candy$State %in% IN_Names] <- "Indiana"
candy$State[candy$State %in% MO_Names] <- "Missouri"
candy$State[candy$State %in% FL_Names] <- "Florida"
candy$State[candy$State %in% NJ_Names] <- "New Jersey"
candy$State[candy$State %in% MI_Names] <- "Michigan"
candy$State[candy$State %in% OH_Names] <- "Ohio"
candy$State[candy$State %in% MD_Names] <- "Maryland"
candy$State[candy$State %in% DC_Names] <- "Washington, DC"
candy$State[candy$State %in% NM_Names] <- "New Mexico"
candy$State[candy$State %in% IA_Names] <- "Iowa"
candy$State[candy$State %in% KS_Names] <- "Kansas"
candy$State[candy$State %in% CT_Names] <- "Connecticut"
candy$State[candy$State %in% MA_Names] <- "Maine"
candy$State[candy$State %in% NH_Names] <- "New Hampshire"
candy$State[candy$State %in% NV_Names] <- "Nevada"
candy$State[candy$State %in% RI_Names] <- "Rhode Island"
candy$State[candy$State %in% UT_Names] <- "Utah"
candy$State[candy$State %in% WI_Names] <- "Wisconsin"
candy$State[candy$State %in% WV_Names] <- "West Virginia"
candy$State[candy$State %in% AB_Names] <- "Alberta"
candy$State[candy$State %in% SC_Names] <- "South Carolina"
candy$State[candy$State %in% KY_Names] <- "Kentucky"
candy$State[candy$State %in% TN_Names] <- "Tennessee"
candy$State[candy$State %in% AZ_Names] <- "Arizona"
candy$State[candy$State %in% VT_Names] <- "Vermont"
candy$State[candy$State %in% OK_Names] <- "Oklahoma"
candy$State[candy$State %in% NS_Names] <- "Nova Scotia"
candy$State[candy$State %in% HI_Names] <- "Hawaii"
candy$State[candy$State %in% QC_Names] <- "Quebec"

# replacing country names
candy$COUNTRY[candy$COUNTRY %in% USA_Names] <- "United States"
candy$COUNTRY[candy$COUNTRY %in% Canada_Names] <- "Canada"
candy$COUNTRY[candy$COUNTRY %in% UK_Names] <- "United Kingdom"
candy$COUNTRY[candy$COUNTRY %in% Unknowns] <- "Unknown"
candy$COUNTRY[candy$COUNTRY == "germany"] <- "Germany"
candy$COUNTRY[candy$COUNTRY == "australia"] <- "Australia"
candy$COUNTRY[candy$COUNTRY == "Korea"] <- "South Korea"
candy$COUNTRY[candy$COUNTRY ==  "hong kong"] <- "Hong Kong"

# Age Conversions
candy$AGE[candy$AGE =="59 on the day after Halloween"] <- "59"
candy$AGE[candy$AGE =="60+"] <- "60"
candy$AGE[candy$AGE =="70 1/2"] <- "70"
candy$AGE[candy$AGE %in% Age_Conv_46] <- "46"
candy$AGE[candy$AGE %in% Age_Conv_40] <- "40"
candy$AGE[candy$AGE %in% Age_Conv_50] <- "50"
candy$AGE[candy$AGE %in% Age_Conv_Un] <- NA
candy$AGE <- as.integer(candy$AGE)

candy <- candy %>%
  select(-"JOY OTHER",-"DESPAIR OTHER",-"OTHER COMMENTS",-"DRESS",-"DAY",-"MEDIA [Daily Dish]",-"MEDIA [Science]",-"MEDIA [ESPN]",-"MEDIA [Yahoo]",-"Click Coordinates (x, y)",-"Whole Wheat anything",-"White Bread",-"Vicodin",-"Vials of pure high fructose corn syrup, for main-lining into your vein",-"Real Housewives of Orange County Season 9 Blue-Ray",-"Pencils",-"Mint Juleps",-"Abstained from M&M'ing.",-"Green Party M&M's",-"Independent M&M's",-"Kale smoothie",-"Senior Mints",-"Hugs (actual physical hugs)",-"Healthy Fruit",-"Generic Brand Acetaminophen",-"Glow sticks",-"Dental paraphenalia",-"Chardonnay",-"Cash, or other forms of legal tender",-"Candy that is clearly just the stuff given out for free at restaurants",-"Broken glow stick",-"Bonkers (the board game)",-"Any full-sized candy bar", -"GOING OUT?",-"Creepy Religious comics/Chick Tracts")
candy <- candy %>%
  rename("Sourpatch Kids" = "Sourpatch Kids (i.e. abominations of nature)","Reeses" = "Reeses Peanut Butter Cups", "Mary Janes" = "Anonymous brown globs that come in black and orange wrappers\t(a.k.a. Mary Janes)")
# Convert Ratings to Numeric values
testf <- function(x)  {
    ifelse(x=="DESPAIR", -1, ifelse(x=='JOY', 1, 0))
}
candy <- candy %>% 
  mutate_at(vars(`100 Grand Bar`:`York Peppermint Patties`), testf)
candy <- candy %>%
  mutate(AgeRange = cut(AGE,
                        breaks=c(-Inf,20, 25, 30, 35, 40, 45, 50,55,60,Inf), 
                        labels=c("Under 20", "20-25", "25-30", "30-35", "35-40", "40-45", "45-50","50-55","55-60","Over 60")))

# Gather Candy Types into a single column
candy2 <- candy %>%
  gather(`100 Grand Bar`:`York Peppermint Patties`, key="Candy Type",value = "Rating")
```

### Dataset and Questions

**Overall question and it's importance:** What candies are the most universally liked and disliked? 

Understanding which candies are the most popular informs us of what qualities to keep in mind when designing a new candy.

**Why the answer matters:** There are a variety of conclusions which can be drawn depending on who the company wants their new product to target. Universally liked candies offer a safe bet, universally disliked offer some qualities to avoid, while those in between could represent somewhat effective ideas which can be improved upon.

**Conclusions:** The score variable describes the total number of likes (+1) and dislikes (-1) a candy received. Positive scores indicate candies that were liked overall, negatives indicate candies that were disliked overall.
The highest scoring candies were:
```{r}
candy3 <- candy2 %>%
  group_by(`Candy Type`) %>%
  filter(!is.na(Rating)) %>%
  summarize(Score = sum(Rating)) %>%
  arrange(desc(Score))
candy3 %>%
  top_n(10)
```
The 10 lowest scoring:
```{r}
candy3 %>%
  arrange(Score)
```
The candies receiving the most likes and dislikes follow the above summaries more or less. The candies receiving the most "Meh" ratings were:
```{r}
candy2 %>%
  filter(Rating == 0) %>%
  group_by(`Candy Type`) %>%
  summarize(Meh = n()) %>%
  arrange(desc(Meh))
```
Lastly, the candies which received the most non-responses:
```{r}
candy2 %>%
  filter(is.na(Rating)) %>%
  group_by(`Candy Type`) %>%
  summarize(count = n()) %>%
  arrange(desc(count))
```
The overall distribution of Scores for candies:
```{r}
ggplot(candy3) +
  geom_histogram(aes(Score),bins=50)+
  ylab("Number of Candy Types")+
  xlab("Overall Score")+
  ggtitle("Overall distribution of Scores")
```

**Recommendations:** The most popular candies all contain chocolate paired with some other flavor. A safe bet for a new product is to start with chocolate and experiment with adding additional flavors. Hard candies tend to be less popular overall, so if designing a new hard candy, it should target a specific group. (i.e. a sour, hard candy could be popular among younger age groups)

We also found that:

* Preferences for candy don't significantly vary among genders.
* Sour candies should only be designed with a younger audience in mind, as we found that older demographics dislike sour flavors.
* The top candies are similar in various regions of the US and Internationally, but outside the top 5 there is some variety in preferences. So, there is some indication that regionally targetted candy choices would be successful.

**Description of Dataset:** This dataset came from an internet survey, where users could input whatever they wanted for age, country, state and gender. As a result, the majority of the work tidying this dataset was converting the many different responses for each category into a single name, so they could be more easily grouped. 

For the candy related questions, only 3 inputs were allowed: "Despair", "Meh", and "Joy". Once the various inputs were grouped properly, the candy inputs were converted to -1, 0, and 1 respectively, so they could be easily summed.

Then, we dropped the irrelevant columns and gathered the candy data into a single column. The dataset is now tidy and ready to be analyzed.

Finally, we ran summaries on the various demographics of the dataset, generated the score variable to compare overall preferences among candy types, and ran a variety of filters to focus on subsets of the data, both for summaries and plots.

### Individual Findings and Plots

#### Andrew

**Andrew's Question:** Are certain candies more likely to be popularized and disliked by Country?

First, I separted the candy data set into 3 different data sets based upion which country the person was from. This will allows us to compare the most popular candies as well as those that were the most disliked.
```{r}
UScandy <- candy2 %>%
  filter(COUNTRY == 'United States', !is.na(Rating)) %>%
  group_by(`Candy Type`) %>%
  summarize(Rating = sum(Rating)) %>%
  arrange(desc(Rating))
topUS <- UScandy %>%
  top_n(10)

Ukcandy <- candy2 %>%
  filter(COUNTRY == 'United Kingdom', !is.na(Rating)) %>%
  group_by(`Candy Type`) %>%
  summarize(Rating = sum(Rating)) %>%
  arrange(desc(Rating))
topUk <- Ukcandy %>%
  top_n(10)

Ccandy <- candy2 %>%
  filter(COUNTRY == 'Canada', !is.na(Rating)) %>%
  group_by(`Candy Type`) %>%
  summarize(Rating = sum(Rating)) %>%
  arrange(desc(Rating))
topC <- Ccandy %>%
  top_n(10)
```
After filtering through to find the popular candy for each country, we found that each country had a favorite candy. It was also recongnized that the majority of observations in the candy data set were from the Unitd States while the United Kingdom had a very small sample size. The common favorite candies within each countries' top ten are Reeses, Kit Kat, Tolberone, Mars, and Twix. 
  
Now that we know the favorite candies for each country, it would be also interesting to analyze the least favorite candies.


```{r}
dlUS <- candy2 %>%
  filter(Rating == -1, COUNTRY =="United States") %>%
  group_by(`Candy Type`) %>%
  summarize( Disliked = n()) %>%
  arrange(desc(Disliked))

dlUk <- candy2 %>%
  filter(Rating == -1, COUNTRY =="United Kingdom") %>%
  group_by(`Candy Type`) %>%
  summarize( Disliked = n()) %>%
  arrange(desc(Disliked))

dlC <- candy2 %>%
  filter(Rating == -1, COUNTRY =="Canada") %>%
  group_by(`Candy Type`) %>%
  summarize( Disliked = n()) %>%
  arrange(desc(Disliked))
```
It was interesting to find that every country hates gum from baseball cards, little marshmellows from circus peanuts, and Box'o'raisins. Although there were less entries for Canada and United Kingdom, it was interesting to notice that each had similar favorites and least favorites.
```{r, eval=FALSE}
topUS %>%
  ggplot(aes(x = reorder(`Candy Type`, Rating), y = Rating))+
  geom_col(stat = "identity") +
  ggtitle("United States Favorite Candies")+
  xlab("Candy")+
  ylab("Number of People")+
  coord_flip()

topUk %>%
  ggplot(aes(x = reorder(`Candy Type`, Rating), y = Rating))+
  geom_col(stat = "identity") +
  ggtitle("United Kingdoms Favorite Candies")+
  xlab("Candy")+
  ylab("Number of People")+
  coord_flip()

topC %>%
  ggplot(aes(x = reorder(`Candy Type`, Rating), y = Rating))+
  geom_col(stat = "identity") +
  ggtitle("Canada's Favorite Candies")+
  xlab("Candy")+
  ylab("Number of People")+
  coord_flip()

```


#### Brian

**Brian's Question:** Which candies are the most and least polarizing (liked by one age group and disliked by another)?

First, ages needed to be consolidated into groups:
```{r, eval=FALSE}
candy <- candy %>%
  mutate(AgeRange = cut(AGE,
                        breaks=c(-Inf, 20, 25, 30, 35, 40, 45, 50, 55, 60, Inf), 
                        labels=c("Under 20", "20-25", "25-30", "30-35", "35-40", "40-45", "45-50", "50-55", "55-60", "Over 60")))
```

The age demographics of the dataset are:
```{r}
(Responses_per_Agegroup <- candy %>%
  group_by(AgeRange) %>%
  filter(!is.na(AgeRange)) %>%
  summarize(Responses = n()))
```
The age groups vary in size, so a new variable is made based on the average score given per respondent in a given group. 
Votes of 0 and NA are equivalent for this calculation, as only dislikes and likes influence the score variable. Since 0 signifies indifference, it seems reasonable to equate non-answers to indifference (or no opinion) on a given candy.
```{r}
Score_per_Agegroup <- candy2 %>%
  group_by(AgeRange,`Candy Type`) %>%
  filter(!is.na(Rating) & !is.na(AgeRange)) %>%
  summarize(Score = sum(Rating))

(Score_over_Responses <- left_join(Score_per_Agegroup, Responses_per_Agegroup, by="AgeRange") %>%
  mutate(AvgScore = Score/Responses) %>%
  arrange(desc(AvgScore)))
```
Finally, to get an idea for how preferences differ among ages, we look at the range of average scores for each candy:
```{r}
(Score_Range <- Score_over_Responses %>%
  group_by(`Candy Type`) %>%
  summarize(ScoreRange = max(AvgScore)-min(AvgScore)) %>%
  arrange(desc(ScoreRange)))
```
Sourpatch Kids stand out as highly divisive:
```{r}
Score_over_Responses %>%
  filter(`Candy Type` == "Sourpatch Kids")
```
Distaste for Sourpatch Kids increases with age: the youngest age groups like them overall, as we increase through the age groups, respondents begin to dislike them overall with increasing regularity.

The least divisive candies:
```{r}
Score_Range %>% arrange(ScoreRange)
```
Peanut M&Ms are liked by all groups, with little difference in scores:
```{r}
Score_over_Responses %>%
  filter(`Candy Type` == "Peanut M&Ms")
```
Visualizing the Average scores of some notable candies:
```{r}
Notable_Candy <- Score_over_Responses %>%
  filter(`Candy Type` == "Peanut M&Ms"|`Candy Type` == "Sourpatch Kids"|`Candy Type` == "Nerds"|`Candy Type` == "Twix"| `Candy Type` == "Peeps"|`Candy Type` == "Reeses")
ggplot(Notable_Candy)+
  geom_point(aes(AvgScore,`Candy Type`,color=AgeRange))+
  ylab("")+
  xlab("Average Score")+
  scale_color_discrete("Age Range")
```

So, we conclude that sour candies should be made with younger people in mind, while chocolate and nut combinations seem to be universally popular.

**Reflections:** Whenever a product's target demographic is children, care should be taken when advertising; the goal is to make something they enjoy while recognizing they lack the skills to moderate themselves properly.

#### Charles

**Charles' Question:** Are there any candies which are predominantly popular to a particular sex/gender? Which candies, if any, are preferred predominantly by men or women?

The first task is to view the favorite candies of men and women. By filtering from the candies to find the 10 most popular for men and women we can begin to envision if men and women have similar tastes in candies.

```{r}
men_candy <- candy2 %>%
  filter(GENDER == 'Male', !is.na(Rating)) %>%
  group_by(`Candy Type`) %>%
  summarize(Score = sum(Rating)) %>%
  arrange(desc(Score))
mc <- men_candy %>%
  top_n(10)

mc

women_candy <- candy2 %>%
  filter(GENDER == 'Female',!is.na(Rating)) %>%
  group_by(`Candy Type`) %>%
  summarize(Score = sum(Rating)) %>%
  arrange(desc(Score))
wc <- women_candy %>%
  top_n(10)

wc
```

Overall the top candy choices of men and women are highly similar. 4 of the top 5 candies for men and women are identical. There is some preference from women to eat candied bars, but overall the difference between men and women's tastes in candy is not significant when viewing their favorite candies. This observation leads to a different question. If men and women like the same candies, do they also dislike the same candies.

```{r}
lf_m <- candy2 %>%
  filter(Rating == -1, GENDER == 'Male') %>%
  group_by(`Candy Type`) %>%
  summarize(Dislike = n()) %>%
  arrange(desc(Dislike))

lf_m

lf_w <- candy2 %>%
  filter(Rating == -1, GENDER == 'Female') %>%
  group_by(`Candy Type`) %>%
  summarize(Dislike = n()) %>%
  arrange(desc(Dislike))

lf_w
```
Men and Women also dislike the same candies at the same rate. The similarity of their dislike of certain foods is even more similar than their appreciation of those foods. Simply viewing the results provides no reason to believe that candies' popularities are driven or correlated to the gender of the consumer. This is intuitive, because having a gender-neutral candy pushes sales onto both men and women, increasing profitability.

```{r}
mc %>%
  ggplot(aes(x = fct_reorder(`Candy Type`, Score), y = Score))+
  geom_bar(stat = "identity") +
  ggtitle("Men's Favorite Candies")+
  xlab("Candy")+
  coord_flip()

wc %>%
  ggplot(aes(x = fct_reorder(`Candy Type`, Score), y = Score))+
  geom_bar(stat = "identity") +
  ggtitle("Women's Favorite Candies")+
  xlab("Candy")+
  coord_flip()
```

Ultimately, I have not been able to determine meaningful differences in the tastes for women and men of candies. This is useful to a degree because it demonstrates that companies have not wedged the market of sweets into what are "men's tastes" and "women's tastes."

#### Clint

**Clint's Question:** Does the popularity of candy vary by region or state? Are some candies unviversally popular? 
The region grouping by which my analysis will be conducted is based off of the nine regions used by the National Climate Data Center.

```{r}
# gathering states into regions 

candy_us <- candy2%>%
  filter(COUNTRY == 'United States', !is.na(Rating))%>%
  group_by(`Candy Type`) %>%
  summarize(Score = sum(Rating)) %>%
  arrange(desc(Score))%>%
  top_n(10)

candy_nwp <- candy2%>%
  filter(COUNTRY == 'United States', State %in% c('Washington', 'Oregon', 'Idaho', 'Alaska', 'Hawaii'), !is.na(Rating))%>%
  group_by(`Candy Type`) %>%
  summarize(Score = sum(Rating)) %>%
  arrange(desc(Score))%>%
  top_n(10)

candy_west <- candy2%>%
  filter(COUNTRY == 'United States', State %in% c('California', 'Nevada'), !is.na(Rating))%>%
  group_by(`Candy Type`) %>%
  summarize(Score = sum(Rating)) %>%
  arrange(desc(Score))%>%
  top_n(10)


candy_sw <- candy2%>%
  filter(COUNTRY == 'United States', State %in% c('Colorado', 'New Mexico', 'Arizona', 'Utah'), !is.na(Rating))%>%
  group_by(`Candy Type`) %>%
  summarize(Score = sum(Rating)) %>%
  arrange(desc(Score))%>%
  top_n(10)


candy_wnc <- candy2%>%
  filter(COUNTRY == 'United States', State %in% c('Wyoming', 'Montana', 'North Dakota', 'South Dakota', 'Nebraska'), !is.na(Rating))%>%
  group_by(`Candy Type`) %>%
  summarize(Score = sum(Rating)) %>%
  arrange(desc(Score))%>%
  top_n(10)


candy_south <- candy2%>%
  filter(COUNTRY == 'United States', State %in% c('Kansas', 'Oklahoma', 'Texas', 'Arkansas', 'Louisiana'), !is.na(Rating))%>%
  group_by(`Candy Type`) %>%
  summarize(Score = sum(Rating)) %>%
  arrange(desc(Score))%>%
  top_n(10)


candy_enc <- candy2%>%
  filter(COUNTRY == 'United States', State %in% c('Wisconsin', 'Iowa', 'Minnesota', 'Michigan'), !is.na(Rating))%>%
  group_by(`Candy Type`) %>%
  summarize(Score = sum(Rating)) %>%
  arrange(desc(Score))%>%
  top_n(10)


candy_central <- candy2%>%
  filter(COUNTRY == 'United States', State %in% c('Missouri', 'Indiana', 'Illinois', 'Ohio', 'Kentucky', 'West Virginia'), !is.na(Rating))%>%
  group_by(`Candy Type`) %>%
  summarize(Score = sum(Rating)) %>%
  arrange(desc(Score))%>%
  top_n(10)


candy_ne <- candy2%>%
  filter(COUNTRY == 'United States', State %in% c('Maryland', 'Delaware', 'New Jersey', 'Pennsylvania', 'New York', 'Connecticut', 'Rhode Island', 'Massechusetts', 'Vermont', 'New Hampshire', 'Maine'), !is.na(Rating))%>%
  group_by(`Candy Type`) %>%
  summarize(Score = sum(Rating)) %>%
  arrange(desc(Score))%>%
  top_n(10)


candy_se <- candy2%>%
  filter(COUNTRY == 'United States', State %in% c('Virginia', 'North Carolina', 'South Carolina', 'Georgia', 'Florida', 'Alabama'), !is.na(Rating))%>%
  group_by(`Candy Type`) %>%
  summarize(Score = sum(Rating)) %>%
  arrange(desc(Score))%>%
  top_n(10)

candy_canada <- candy2%>%
  filter(COUNTRY == 'Canada', !is.na(Rating))%>%
  group_by(`Candy Type`) %>%
  summarize(Score = sum(Rating)) %>%
  arrange(desc(Score))%>%
  top_n(10)

candy_int <- candy2%>%
  filter(COUNTRY != 'United States', COUNTRY != 'Canada', !is.na(Rating))%>%
  group_by(`Candy Type`) %>%
  summarize(Score = sum(Rating)) %>%
  arrange(desc(Score))%>%
  top_n(10)

```

```{r}
#creating graphs 

ggplot(data = candy_us)+
  geom_col(aes(x = reorder(`Candy Type`, -`Score`), y = candy_us$Score)) +  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=90, hjust=1)) +
  ylab("Candy Popularity") +
  ggtitle("Most Popular Candies in the United States")+
  xlab("Candy Type")

ggplot(data = candy_ne)+
  geom_col(aes(x = reorder(`Candy Type`, -`Score`), y = candy_ne$Score)) +  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=90, hjust=1)) +
  ylab("Candy Popularity") +
  ggtitle("Most Popular Candies in the Northeast United States")+
  xlab("Candy Type")
  

ggplot(data = candy_central)+
  geom_col(aes(x = reorder(`Candy Type`, -`Score`), y = candy_central$Score)) +  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=90, hjust=1)) +
  ylab("Candy Popularity") +
  ggtitle("Most Popular Candies in the Central United States")+
  xlab("Candy Type")

ggplot(data = candy_enc)+
  geom_col(aes(x = reorder(`Candy Type`, -`Score`), y = candy_enc$Score)) +  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=90, hjust=1)) +
  ylab("Candy Popularity") +
  ggtitle("Most Popular Candies in the East North Central United States")+
  xlab("Candy Type")

ggplot(data = candy_nwp)+
  geom_col(aes(x = reorder(`Candy Type`, -`Score`), y = candy_nwp$Score)) +  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=90, hjust=1)) +
  ylab("Candy Popularity") +
  ggtitle("Most Popular Candies in the Northwest and Pacific United States")+
  xlab("Candy Type")

ggplot(data = candy_se)+
  geom_col(aes(x = reorder(`Candy Type`, -`Score`), y = candy_se$Score)) +  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=90, hjust=1)) +
  ylab("Candy Popularity") +
  ggtitle("Most Popular Candies in the Southeast United States")+
  xlab("Candy Type")

ggplot(data = candy_south)+
  geom_col(aes(x = reorder(`Candy Type`, -`Score`), y = candy_south$Score)) +  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=90, hjust=1)) +
  ylab("Candy Popularity") +
  ggtitle("Most Popular Candies in the Southern Region of the United States") +
  xlab("Candy Type")

ggplot(data = candy_sw)+
  geom_col(aes(x = reorder(`Candy Type`, -`Score`), y = candy_sw$Score)) +  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=90, hjust=1)) +
  ylab("Candy Popularity") +
  ggtitle("Most Popular Candies in the Southwest United States")+
  xlab("Candy Type")


ggplot(data = candy_west)+
  geom_col(aes(x = reorder(`Candy Type`, -`Score`), y = candy_west$Score)) +  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=90, hjust=1)) +
  ylab("Candy Popularity") +
  ggtitle("Most Popular Candies in the Western Region of the United States") +
  xlab("Candy Type")

ggplot(data = candy_wnc)+
  geom_col(aes(x = reorder(`Candy Type`, -`Score`), y = candy_wnc$Score)) +  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=90, hjust=1)) +
  ylab("Candy Popularity") +
  ggtitle("Most Popular Candies in the Western North Central Region of the United States") +
  xlab("Candy Type")

ggplot(data = candy_canada)+
  geom_col(aes(x = reorder(`Candy Type`, -`Score`), y = candy_canada$Score)) +  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=90, hjust=1)) +
  ylab("Candy Popularity") +
  ggtitle("Most Popular Candies in Canada")+
  xlab("Candy Type")

ggplot(data = candy_int)+
geom_col(aes(x = reorder(`Candy Type`, -`Score`), y = candy_int$Score)) +  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=90, hjust=1)) +
  ylab("Candy Popularity") +
  ggtitle("Most Popular Candies Outside the US or Canada") +
  xlab("Candy Type")
```

Through examination of the graphs it is clear that the variation between candy popularity across regions is not quite as large as one might initially surmise. Candies like Reeses, Kit Kat, Snickers, and Twix dominate the top five most popular candies across most of the United States. The Western North Central region of the United States had the largest difference from the other US regions and the Canadian region bared more similarities to the US than the international subset. While the top end is dominated by some of the same candies there is more variation at the 6-10 slots in most popular candies chart. Firms outside the top 5 main candies are able to grab meaningful popularity at a regional level and shouldn't be discouraged by the overall popularity of the main candies. 


### Individual Contributions

**Andrew:**

**Brian:** I found the dataset and did the majority of the tidying. I used a variety of joins, mutates, etc. to create some new variables to compare preferences across groups of differing sizes.

**Charles:** I mutated the dataset to view it specifically from the perspectives of gender, and tested to see if gender caused meaningful variations in the preferences of candies.


**Clint::** I used the tidy dataset to filter by regions in the US and then created collumn graphs for each region and for the United States in general. I then compared the graphs to each other and to the US candy popularity graph in general. 
