---
title: 'Lab 15: Final Project'
author: "Brian Teklits, Charles Doremieux, Andrew MacLean, Clint LaBattaglia"
date: "12/16/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE,message=FALSE)
library(modelr)
library(tidyverse)
library(maps)
library(lubridate)
# install.packages("openintro")
library(openintro)
# Data from: https://www.kaggle.com/sobhanmoosavi/us-accidents
# LARGE: do not upload to github
accidents <- read_csv("US_Accidents_May19.csv")

```

## Main Question

**Domain Expert and Dataset:**

The domain expert is the NHTSA, the National Highway Traffic Safety Administration.

The dataset we are using can be found [here.](https://www.kaggle.com/sobhanmoosavi/us-accidents) It contains 2.25 million records of accidents from 49 different states, starting in February 2016 until March 2019. It includes data on the severity of the accident, where and when the accident occurred, the weather at the time of the accident, and various information about the nearby surroundings. 

**Main Question & it's Importance:**
Lead with your main overall question, why it’s important (and why those reasons are important), 

**Answer:**
your answer/conclusion, 
**Recommendation:**
```{r}

```

recommendation, and a plot communicating your conclusion or basis for your recommendation. 

## Individual Sections

Each teammate must apply “recently learned” programming tools to answer a subquestion that will help your team answer the overall question. The subquestions must be different from the overall team question. Each subquestion should get its own subsection in the team report and should follow the format for statistical analyses that we have learned in class.

What is the question? Why is it important/interesting?

What new tools did you use?

What is the answer to the question? How does this relate to the overall question?

What are the ethical implications of your findings, conclusions, or recommendations?

### Andrew

### Brian

### Charles

```{r}
cd_data <- accidents %>%
  mutate(a_start = ymd_hms(Start_Time)) %>%
  mutate(a_end = ymd_hms(End_Time)) %>%
  mutate(accident_time = difftime(a_end, a_start, units = "mins")) %>%
  filter(!is.na(`Humidity(%)`), !is.na(accident_time)) %>%
  filter(accident_time >= 0 & accident_time <= 4320) %>%
  select(a_start, a_end, accident_time, `Humidity(%)`)
```

```{r}
humid_time_model <- lm(cd_data$accident_time ~ `Humidity(%)`, data = cd_data)

humid_preds <- cd_data %>%
  data_grid(`Humidity(%)` = seq_range(`Humidity(%)`, 2178823)) %>%
  add_predictions(humid_time_model,'predictions') %>%
  add_residuals(humid_time_model, 'residuals')
```

```{r}
ggplot() +
  geom_point(data = cd_data, aes(`Humidity(%)`,accident_time))+
  ggtitle("View of Humidity as it Relates to Accident Duration")+
  xlab("Humidity (%)")+
  ylab("Accident Time (minutes)")
```

```{r}
ggplot()+
  geom_line(data = humid_preds, aes(`Humidity(%)`, humid_preds$predictions))+
  ggtitle("Predictions of Humidities Related to Accident Duration")+
  xlab("Humidity (%)")+
  ylab("Accident Time (minutes)")
```

```{r}
ggplot()+
  geom_line(data = humid_preds, aes(`Humidity(%)`, humid_preds$residuals))+
  ggtitle("Residuals of Humidities Related to Accident Duration")+
  xlab("Humidity (%)")+
  ylab("Accident Time (minutes)")
```

### Clint
Question Ideas: Explore relationship between severity of accidents and stoplights + percentage of accidents with each of the binary variables. 
uses map functino to take percentiles if true false sections and graph + permutation test to see if there is correlation between severity of accident and presence of stoplight or just most common accident indicator +
Question: Which of the true/false variables is the greatest predictor of an accident, and are any of them related to a the probability of a more severe accident?

First I want to examine the percentage of total accidents associated with each of the true/false columns so  created a for loop which calculated the percentage of total accidents which had a true response for each of the columns and stored it in a dataframe called sums_true.
```{r}
library(knitr)
explore <- accidents%>%
  select(Amenity, Bump, Crossing, Give_Way, Junction, No_Exit, Railway, Roundabout, Station, Stop, Traffic_Calming, Traffic_Signal, Turning_Loop)

sums_true <- data.frame(mode = "double", ncol(explore))
for (i in seq_along(explore)) {
  sums_true[i] <- (sum(explore[[i]])/tally(accidents))*100
}
```
From there I can see that eight of the thirteen variables are true in less than 1 percent of observed accidents so, while that doesn't make them negligable, I would prefer to focus on the more significant variables. It is also worth noting that the total of all percentages added together is 34.66% which means 65.34% of accidents didn't have any of the true/false variable associated with them.  

```{r}
ggplot(data = sums_true) + geom_col(aes(x= 1, y = sums_true$n.9, fill = "Traffic Signal"))+
  geom_col(aes(x= 2, y = sums_true$n.2, fill = "Junction")) +
  geom_col(aes(x = 3, y = sums_true$n, fill = "Crossing"))+
  geom_col(aes(x = 4, y = sums_true$n.6, fill = "Station"))+
  geom_col(aes(x = 5, y = sums_true$mode, fill = "Amenity"))+
  ggtitle("Top Five Presence at Accident Percentages")+
  ylab("Percent of Accidents Present")+
  xlab("Rank")
```
## Reflections on Lab 2

As a team, restate your team’s goal(s) and reflect on how well you achieved it. If you could travel back in time, which is one thing you would tell your team to keep doing? Stop doing? Start doing? Discuss this as a team and add it as a section to your Final Project.

### Individual Reflections

Individually, write a paragraph reflecting on: how have your six-month or 5-year goals changed? What did you learn/accomplish in this course? If you could give yourself advice at the beginning of the semester, what would you tell yourself to keep doing, stop doing, and start doing?

**Andrew:**

**Brian:**

**Charles:** 

**Clint:**
  Since the beginning of the semester my 6-month to five-year goals have changed in that I have less confidence my ability to thrive in a coding driven profession than I had at the beginnning of the semester. This is useful information to know as I have been considering going into a business masters program in which coding and statistics would feature prominently. Now I am wondering if this is the right path after all. In this course I learned what feels like the basics of programming in R, though I am not a proficcient as a I could or should be, and I also feel as though I learned about the basics of statistics in general which has been really interesting. If I could past me advice I would tell myself to do all the exercises when going through the R4DS textbook, experiment when doing the labs instead of doing the bare minimum, communicate more concisely with my teammates, and go to office hours w/ the professor and TAs.
### Individual Contributions

**Andrew:**

**Brian:**

**Charles:** 

**Clint:**
