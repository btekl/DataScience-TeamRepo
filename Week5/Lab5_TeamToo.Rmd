---
title: "Lab 5"
author: "Brian Teklits, Charles Doremieux, Andrew MacLean, Clint LaBattaglia"
date: "9/25/2019"
output: html_document
---

```{r setup,include=FALSE}
library(tidyverse)
milk <- read.csv('state_milk_production.csv')
milk <- milk %>%
  mutate(milk_million = milk_produced/1000000)
```


### Team Plot
```{r}
milkteam <- milk %>%
  filter(state %in% c('New York','Colorado','California','New Jersey','Washington')) %>%
  select(state, year, milk_million)
by_year <- milkteam %>%
  group_by(year) %>%
  summarise(avg = mean(milk_million))
```

```{r}
ggplot(data = milkteam, aes(x = year, y = milk_million)) +
  geom_point(aes(color = state)) +
  geom_smooth(data=by_year,aes(year, avg),se=FALSE)+
  ggtitle('Pounds of milk over time by state') +
  xlab('Year') +
  ylab('Milk Produced (Million lb)')
```

**What does this plot convey:** The blue line represents the average production of all 50 states for a given year. The average milk production per year across the entire US has increased substantially since 1970. California, in particular, has increased its milk production by almost 4 times since 1970. New Jersey appears to have had a slight decrease in production, while the other 3 states have increased production at a modest rate.

#### Team Data Summary

**The year with the most milk produced:** 2017
```{r}
milk %>%
  group_by(year) %>%
  summarise(total_production = sum((milk_million))) %>% 
  filter(total_production == max(total_production))
```
**The year with the least milk produced:** 1975
```{r}
milk %>%
  group_by(year) %>%
  summarise(total_production = sum((milk_million))) %>% 
  filter(total_production == min(total_production))
```
**The top 5 milk producers of 2017:**
```{r}
milk %>%
  filter(year==2017) %>%
  select(state,milk_million) %>%
  arrange(desc(milk_million)) %>%
  filter(min_rank(desc(milk_million)) < 6)
```
**The bottom 5 milk producers of 2017:**
```{r}
milk %>%
  filter(year==2017) %>%
  select(state,milk_million) %>%
  arrange((milk_million)) %>%
  filter(min_rank((milk_million)) < 6)
```

#### Reflections

**What was most helpful in learning about this data:** Exploring the various data transformation functions and how to use them in conjunction with each other made the pipe operator a lot easier to understand.

**Who could benefit the most from this analysis? Who could be harmed by it?:** We could use this data to determine states which are candidates for increasing their milk production. Increasing production in specific locations may lead to greater profits for farmers/investors. 

However, the environmental effects of dairy farming are substantial. Livestock are responsible for roughly 14.5% of greenhouse gas emissions globally[^1]. Additionally, the dairy industry uses a substantial amount of water when raising livestock, around 40-50 gallons per day per cow[^2].

So, while increasing milk production in a state may lead to increased revenue, residents of that state may see increasing water costs, as well as the global negative effects of increased greenhouse gas emissions.

[^1]:[source](http://www.fao.org/news/story/en/item/197623/icode/)
[^2]:[source](http://wdmc.org/2013/Scientific%20Data%20for%20Developing%20Water%20Budgets%20on%20a%20Dairy.pdf)
### Individual Sections

#### Charles' Plot

```{r}
milk1999 <- milk %>%
  filter(year == 1999)
ggplot(data = milk1999, aes(x = milk_million)) +
  geom_density() + 
  ggtitle('Milk Produced in 1999 by State')+
  xlab("millions of pounds of milk")
  

# ggplot(data = milk1999, aes(x = state, y = milk_million)) +
#   geom_col() + 
#   ggtitle('Density of Milk Produced in 1999 by State')+
#   xlab("State")+
#   ylab("millions of gallons of milk")+
#   #facet_wrap(~region)+
#   theme(axis.text.x = element_text(angle=60, hjust=1))+
#   geom_text(aes(label = milk_million), vjust = -0.5)
```

**The average milk produced in year:**
```{r}
#calc avg
# View(milk)

milk1999 %>%
  group_by(year) %>%
  summarise(average_milk_mill = mean(milk_million))


```
**The median milk produced in year:**
```{r}
#calc median

milk1999 %>%
  group_by(year) %>%
  summarise(median_milk_mill = median(milk_million))


```
**The top producing state of year:**
```{r}
#calc max

milk1999 %>%
  group_by(state, milk_million) %>%
  filter(milk_million == max(milk_million))
```
**The state that produced the least in year:**
```{r}
#calc min
```


#### Brian's Plot

```{r}
milk1995 <- milk %>%
  filter(year == 1995)
ggplot(data = milk1995, aes(x = milk_million)) +
  geom_histogram(bins = 15)+
  xlab("Pounds produced in millions")+
  ggtitle('Milk produced in 1995 by state')
```

**The average milk produced in 1995:**
```{r}
milk1995 %>%
  summarise(avg = mean(milk_million))
```
**The median milk produced in 1995:**
```{r}
milk1995 %>%
  summarise(middle = median(milk_million))
```
**The top producing state of 1995:**
```{r}
milk1995 %>% 
  select(state,milk_million) %>% 
  filter(milk_million == max(milk_million))
```
**The state that produced the least in 1995:**
```{r}
milk1995 %>% 
  select(state,milk_million) %>%
  filter(milk_million == min(milk_million))
```


#### Clint's Plot

```{r}
milk1999 <- milk %>%
  mutate(milk_million = milk_produced/1000000) %>%
  filter(year == 1999)
ggplot(data = milk1999, mapping = aes(x = milk_million)) + geom_density() + xlab("Amount of milk produced in millions of gallons") + ggtitle("Milk Production by State in the Year 1999")
```

**The average milk produced in year:**
```{r}
mean_year <- milk1999 %>%
  group_by(year) %>%
  summarise(Mean = mean(milk_million)) %>%
  as_tibble()
mean_year
```
**The median milk produced in year:**
```{r}
median_year <- milk1999 %>%
  group_by(year) %>%
  summarise(Med = median(milk_million)) %>%
  as_tibble()
median_year
```
**The top producing state of year:**
```{r}
milk1999 %>% 
  select(state,milk_million) %>%
  filter(milk_million == max(milk_million))
```
**The state that produced the least in year:**
```{r}
milk1999 %>% 
  select(state,milk_million) %>%
  filter(milk_million == min(milk_million))
```


#### Andrew's Plot

```{r}
milk1998 <- milk %>%
  filter(year == 1998)
ggplot(data = milk, mapping =  aes( x= milk_million))+
  geom_density()+
  xlab("Pounds of Milk in Millions")+
  ggtitle("Milk Produced by Each State in 1998")
```

**The average milk produced in year:**
```{r}
milk1998 %>%
  summarise(average = mean(milk_million))
```
**The median milk produced in year:**
```{r}
milk1998 %>%
  summarise(median = median(milk_million))
```
**The top producing state of year:**
```{r}
milk1998 %>% 
  select(state,milk_million) %>% 
  filter(milk_million == max(milk_million))
```
**The state that produced the least in year:**
```{r}
milk1998 %>% 
  select(state,milk_million) %>%
  filter(milk_million == min(milk_million))
```

