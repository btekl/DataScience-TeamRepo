---
title: 'Lab 6: Airport Data Science'
author: "Brian Teklits, Charles Doremieux, Andrew MacLean, Clint LaBattaglia"
date: "10/4/2019"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
COflights <- read_csv("COflights.csv")

# Remove non-DIA flights
DEN_flights  <- COflights %>%
  filter(ORIGIN == 'DEN'| DEST=='DEN') 
```
```{r}
# function to convert from month/day to total days in year
month_day_to_days <- function(month){
  if(month==1){
    days = 0
  } else if(month==2){
    days = 31
  } else if(month==3){
    days = 31+28 
  } else if(month==4){
    days = 31+28+31
  } else if(month==5){
    days = 31+28+31+30
  } else if(month==6){
    days = 31+28+31+30+31
  } else if(month==7){
    days = 31+28+31+30+31+30
  } else if(month==8){
    days = 31+28+31+30+31+30+31
  } else if(month==9){
    days = 31+28+31+30+31+30+31+31
  } else if(month==10){
    days = 31+28+31+30+31+30+31+31+30
  } else if(month==11){
    days = 31+28+31+30+31+30+31+31+30+31
  } else {
    days = 31+28+31+30+31+30+31+31+30+31+30
  }
  return(days)
}

# Apply function to the dataset
days <- DEN_flights %>%
  mutate(day_of_year = mapply(month_day_to_days,MONTH)+DAY_OF_MONTH)

# Count total flights for all 365 days
flights_per_Day <- days %>%
  group_by(day_of_year) %>%
  summarise(flightcount = n())
# Count total delayed flights for 365 days
delays_per_Day <- days %>%
  group_by(day_of_year) %>%
  filter(ARR_DELAY >= 15) %>%
  summarise(flightcount = n()) 
# combine above data frames into new data frame containing days and probability of delay per day
P_daily_delay <- cbind(flights_per_Day[1],(delays_per_Day[-1]/flights_per_Day[-1]))
```

### What Factors Lead to On-time Arrivals in Denver?


**Why this question is important:**
Delayed flights cause a snowball effect of negative outcomes, affecting everyone at an airport. Travelers can miss flights altogether, runway traffic builds up, stressing both airport employees and air travelers. Analyzing the causes of flight delays can help us reduce the overall strain they cause on an airport.

**Why the answer is relevant:**
Understanding the causes of delayed flights allows us to make predictions on when to expect future delays, as well as informing decisions on how to prevent delays when possible. Eliminating preventable delays and anticipating predictable delays can lead to a smoother airport experience for both travelers and employees.

### Team Plot and Findings

```{r message=FALSE}
ggplot(P_daily_delay,aes(day_of_year,flightcount))+
  geom_line()+
  geom_smooth(se=FALSE)+
  xlab("Day of the Year (out of 365)")+
  ylab("Probability of Delayed Flight")+
  ggtitle("Probability of Delayed Flights throughout 2017")
```

This plot shows a few interesting features. First, we note that the time of year predicts periodic increases and decreases in delays. Delays are more common towards the beginning and end of the year and during the summer months, when overall travel increases. Second, there are periodic changes on a smaller scale as well, suggesting delays may relate to day of the week, or time of month. Finally, there are random spikes throughout, either from specific days of the year (Christmas), or due to other non-time related factors.

### Recommendations

How to reduce flight delays/why implement this change

### Individual Sections

#### Andrew's Plot

```{r}
by_carrier <- COflights %>%
  group_by(MONTH)%>%
  filter(DEST == "DEN", WEATHER_DELAY >14)%>%
  summarise(count = n(), delay = mean(WEATHER_DELAY, na.rm = TRUE))

ggplot(data = by_carrier, aes(by_carrier$MONTH))+
  geom_bar()


```

Identify 2 factors from the data that lead to more or less delayed flights

#### Brian's Plot

```{r message=FALSE}
# take days mod 7 to get day of week (1st of 2017 is sunday, so remainder 1 = sunday, remainder 2 = monday etc.)
P_weekday_delay <- P_daily_delay %>%
  mutate(week_day=day_of_year %% 7)

# map integers to weekday names 
P_weekday_delay$week_dayname <- plyr::mapvalues(P_weekday_delay$week_day,
                           from = c(0,1,2,3,4,5,6),
                           to = c("Saturday","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday"))

ggplot(P_weekday_delay,aes(day_of_year,flightcount,color=factor(week_dayname)))+
  geom_smooth(se=FALSE)+
  ggtitle("Probability of a Delayed flight by Day of Week")+
  ylab("Probability a Flight is Delayed")+
  xlab("Day of the Year")+
  scale_color_discrete("Day of the Week")
```

Day of the week affects delays both positively and negatively. We see that Thursday, Friday, and Monday consistently have higher probability of delays compared to the other days. Saturday and Sunday have a consistently low probability of delay, with Tuesday and Wednesday generally lying between the two extremes.

We also see how the time of year influences delays throughout the week. During the summer months, Thursday, Friday and Monday delays are substantially higher than other days of the week: travelers going on vacation fly out ahead of the weekend, returning on Monday. The beginning and end of year see greater delays on average, both from increased holiday travel and from winter weather.


#### Charles' Plot

```{r}

```

Identify 2 factors from the data that lead to more or less delayed flights

#### Name's Plot

```{r}

```

Identify 2 factors from the data that lead to more or less delayed flights


#### Individual Contributions

**Brian:** I made the function to convert to total day of the year, as well as figuring out how to apply it to the data frame, and using cbind to be able to plot probabilities calculated from summarise. I used the non default scale_color_discrete to edit the title of my plot's legend.

**Name:**

**Name:**

**Name:**
