---
title: 'Lab 11: Baby Names'
author: "Brian Teklits, Charles Doremieux, Andrew MacLean, Clint LaBattaglia"
date: "11/10/2019"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(stringr)
library(babynames)
knitr::opts_chunk$set(warning=FALSE,message=FALSE)

babys18 <- read_csv('yob2018.txt',col_types = cols(
                    name = col_character(),
                    sex = col_character(),
                    n = col_double()))

babys18 <- babys18 %>%
  mutate(prop = n/sum(n)) %>%
  mutate(year = 2018)

babys <- babynames %>%
  full_join(babys18)
```

### Analyzing Baby Names

Clearly for males or females (no gender-ambiguous names)

“Trending” but not “trendy”, i.e., on the upslope but not super-popular today. Maybe very popular in 10-20 years.

Cannot be easily (and commonly) shortened to a nickname (like “Benjamin” to “Ben”)
```{r}
v1 <- babys %>% 
  filter(year %in% c(2016,2017,2018), n<500, sex=='M')
```


### Individual Name Popularity

#### Andrew

#### Brian

```{r}
bri <- babys %>%
  filter(str_detect(name, "^Bri")) %>%
  group_by(year) %>%
  summarise(bri_prop = sum(prop))

brian <- babys %>%
  filter(str_detect(name,"^Br[iy][oa]n"),sex=='M')%>%
  group_by(year) %>%
  summarize(brian_prop = sum(prop))

ggplot()+
  geom_line(data=bri,aes(year,bri_prop,color='Bri Names'))+
  geom_line(data=brian,aes(year,brian_prop,color='Brian Names'))+
  geom_vline(aes(xintercept = 1995, color='1995'), linetype='dashed')+
  scale_color_manual(name='',values=c(`Bri Names`='red', `Brian Names`='black', `1995`='blue'))+
  ylab("Proportion of Total")+
  xlab("Year")+
  ggtitle("Proportion of Names over Time")
```

I used the regex "^Br[iy][oa]n" to match names similar to Brian. I opted not to exclude variants like Bryant, but did restrict based on sex, to exclude variants more commonly female, such as Brianna.

Popularity of both variants of Brian and names beginning with Bri both peaked prior to 1995, consistently decreasing since then. Brian variants peaked between 1960 and 1980, when their proportion was greater than names beginning with Bri. Following this peak, popularity has steadily decreased while names beginning with Bri, and not consisting of Brian variants, peaked in popularity just prior to 1995.

#### Charles

#### Clint

### Ariel and Rachel Regex

We decided to include variants such as Arielle and Ariela in our calculations. The total versions of Ariel by year: 
```{r}
Ariel <- "A[r]+[iy]+.l+.*"
babys %>%
  filter(str_detect(name,Ariel),year %in%c(1973,1988,1990),sex=="F") %>%
  group_by(year)%>%
  summarise(Ariel_Variants = n())
```
We chose to only include variants which ended with 'l'. Variants ending in other letters (Rachelle, Rachelanne, etc.) have significantly differing pronounciations and were thus excluded. The number of versions of Rachel:
```{r}
Rachel <- "Ra[ey]?ch.*l$"
babys %>%
  filter(str_detect(name,Rachel),year %in%c (1973,1988,1990),sex=='F')# %>%
#  group_by(year) %>%
 # summarise(Rachel_Variants = n())
```
The chance a girl would be named a variant of either Rachel or Ariel, for the given years:
```{r}
babys %>%
  filter(str_detect(name,Ariel) | str_detect(name,Rachel),year%in%c(1973,1988,1990,2018),sex=='F') %>%
  group_by(year) %>%
  summarise(Ariel_or_Rachel = sum(prop))
```

### The Little Mermaid Effect

To investigate how the proportion of names changed from 1988 to 1990, we create a variable describing the change in proportion between the years. NA values are replaced with zero, as they represent a name that was not present in the dataset for one of the years. First, we investigate female baby names beginning with vowels:
```{r}
vowel_f_88 <- babys %>%
  filter(str_detect(name,"^[AEIOU]"),sex=='F', year == 1988) 
vowel_f_diff <- babys %>%
  filter(str_detect(name,"^[AEIOU]"), sex=='F', year == 1990) %>%
  full_join(vowel_f_88, by = "name") %>%
  replace_na(list(prop.x=0, prop.y=0)) %>% # replace names which didn't exist in one of the years with 0
  mutate(prop_change = (prop.x-prop.y))
```
Similarly, we calculate the change in proportion for just Ariel variants, and get the total change in proportion for all variants of Ariel combined:
```{r}
ariel_names <- babys %>%
  filter(str_detect(name,Ariel, year %in% c(1988,1990)))

(ariel_prop <- vowel_f_diff %>%
  semi_join(ariel_names) %>%
  summarise(prop_change = sum(prop_change)))
```
When we look at the change in proportion of female names beginning with a vowel, in terms of percentile, our Ariel variants are at:
```{r}
percentile_change <- ecdf(vowel_f_diff$prop_change)
percentile_change(ariel_prop) 
```
Ariel variants are at the 100th percentile of change in proportion among female names beginning with a vowel. However, we're comparing the total change of 12 names (all Ariel variants) to the change in only a single name. So while the total change appears significant, this result may overstate exactly how large the increase in Ariel names actually was.

To get a better idea of how significant this result is, we can compare it to the entire set of female names. We construct the same data, but for the entire set of names in 1988 and 1990:
```{r}
f_88 <- babys %>%
  filter(sex == 'F',year == 1988)

top_changes <- babys %>%
  filter(sex == 'F', year == 1990) %>%
  full_join(f_88, by = "name") %>% 
  replace_na(list(prop.x=0, prop.y=0)) %>%
  mutate(prop_change = (prop.x-prop.y)) %>%
  filter(min_rank(desc(prop_change)) < 15) %>%
  full_join(ariel_prop) %>%
  replace_na(list(name = "Ariel and Variants"))

ggplot()+
  geom_point(data=top_changes, aes(fct_reorder(name,prop_change), prop_change))+
  coord_flip()+
  ggtitle("The 15 Largest Increases in Proportion for Female Names from 1988 to 1990") +
  xlab("")+
  ylab("Change in Proportion of Total")
```

Ariel variants have the 6th largest increase from 1988 to 1990. The name Ariel alone had the 11th largest increase among female names, not including variants of Ariel in the ranking. The overall rankings of these names would likely change, should we aggregate the various spellings for all the names into single categories, as we did for Ariel. However, the high placement of both Ariel alone, and it's aggregated variants suggests a substantial increase in the 2 year period, larger than the vast majority of female names in the same period.

From this, we conclude *The Little Mermaid* did cause an increase in female babies named Ariel in 1990.  

### Changes Among Our Names
1 plot for (age) years before birth, 1 for after

#### Andrew

#### Brian

#### Charles

#### Clint

### Recommendations

### Individual Contributions

**Andrew:**

**Brian:**

**Charles:**

**Clint:**
